import{_ as E,r as h,x as ne,e as r,c as V,o as b,d as e,w as n,h as c,E as R,b as s,t as v,f as M,y as te,z as ee,u as ae,p as le,v as se,A as pe,j as K,m as B,F as me,i as ce,B as _e}from"./index-CXWT5NW2.js";import{useUserStore as Q}from"./user-DnAwSLmC.js";import{s as fe,d as Z}from"./element-china-area-data-DyMRb5Dq.js";import{u as ve}from"./order-CyT1VBxf.js";const ge={class:"user-profile"},be={__name:"UserProfile",setup(H){const m=Q(),o=h({username:"",nickname:"",phone:"",email:""}),$={nickname:[{required:!0,message:"请输入昵称",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"}]},y=h(null),i=()=>{var C,f,p,u;o.value={username:((C=m.userInfo)==null?void 0:C.username)||"",nickname:((f=m.userInfo)==null?void 0:f.nickname)||"",phone:((p=m.userInfo)==null?void 0:p.phone)||"",email:((u=m.userInfo)==null?void 0:u.email)||""}};i(),ne(()=>m.userInfo,i,{deep:!0});const _=()=>{y.value.validate(C=>{C&&(m.updateUserInfo({nickname:o.value.nickname,phone:o.value.phone,email:o.value.email}),R.success("保存成功"))})};return(C,f)=>{const p=r("el-input"),u=r("el-form-item"),w=r("el-button"),S=r("el-form");return b(),V("div",ge,[e(S,{model:o.value,rules:$,ref_key:"formRef",ref:y,"label-width":"100px",class:"profile-form"},{default:n(()=>[e(u,{label:"用户名"},{default:n(()=>[e(p,{modelValue:o.value.username,"onUpdate:modelValue":f[0]||(f[0]=k=>o.value.username=k),disabled:""},null,8,["modelValue"])]),_:1}),e(u,{label:"昵称",prop:"nickname"},{default:n(()=>[e(p,{modelValue:o.value.nickname,"onUpdate:modelValue":f[1]||(f[1]=k=>o.value.nickname=k)},null,8,["modelValue"])]),_:1}),e(u,{label:"手机号",prop:"phone"},{default:n(()=>[e(p,{modelValue:o.value.phone,"onUpdate:modelValue":f[2]||(f[2]=k=>o.value.phone=k)},null,8,["modelValue"])]),_:1}),e(u,{label:"邮箱",prop:"email"},{default:n(()=>[e(p,{modelValue:o.value.email,"onUpdate:modelValue":f[3]||(f[3]=k=>o.value.email=k)},null,8,["modelValue"])]),_:1}),e(u,null,{default:n(()=>[e(w,{type:"primary",onClick:_},{default:n(()=>f[4]||(f[4]=[c("保存修改")])),_:1})]),_:1})]),_:1},8,["model"])])}}},he=E(be,[["__scopeId","data-v-28cd4c40"]]),ye={class:"user-address"},ke={class:"address-header"},xe={class:"address-info"},Ve={class:"name"},$e={class:"phone"},Ce={class:"address"},Ie={__name:"UserAddress",setup(H){const m=Q(),o=h(m.userInfo.addressList||[]),$=h(!1),y=h("add"),i=h({region:[],address:"",name:"",phonePrefix:"+86",phone:"",isDefault:!1,id:null}),_=h(null),C={region:[{required:!0,message:"请选择省市区",trigger:"change"}],address:[{required:!0,message:"请输入详细地址",trigger:"blur"}],name:[{required:!0,message:"请输入收货人姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}]},f=fe;ne(()=>m.userInfo.addressList,g=>{o.value=g||[]},{immediate:!0});const p=()=>{y.value="add",i.value={region:[],address:"",name:"",phonePrefix:"+86",phone:"",isDefault:!1,id:null},$.value=!0,te(()=>_.value&&_.value.clearValidate())},u=g=>{y.value="edit",i.value={...g},$.value=!0,te(()=>_.value&&_.value.clearValidate())},w=g=>{ee.confirm("确定要删除该地址吗？","提示",{type:"warning"}).then(()=>{o.value=o.value.filter(a=>a.id!==g.id),k(),R.success("删除成功")})},S=async()=>{try{if(await _.value.validate(),o.value.some(a=>a.name===i.value.name&&a.phone===i.value.phone&&a.address===i.value.address&&(y.value==="add"||a.id!==i.value.id))){R.error("该地址已存在，请勿重复添加");return}if(y.value==="add")i.value.id=Date.now(),o.value.push({...i.value});else{const a=o.value.findIndex(I=>I.id===i.value.id);a!==-1&&(o.value[a]={...i.value})}k(),$.value=!1,i.value={region:[],address:"",name:"",phonePrefix:"+86",phone:"",isDefault:!1,id:null},_.value&&_.value.clearValidate(),R.success("保存成功")}catch{}};function k(){m.updateUserInfo({addressList:o.value})}const P=g=>`${g.region?g.region.map(I=>Z[I]).join(" "):""} ${g.address}`;return(g,a)=>{const I=r("el-button"),L=r("el-table-column"),j=r("el-table"),F=r("el-cascader"),D=r("el-form-item"),A=r("el-input"),O=r("el-option"),W=r("el-select"),X=r("el-checkbox"),Y=r("el-form"),G=r("el-dialog");return b(),V("div",ye,[s("div",ke,[e(I,{type:"primary",onClick:p},{default:n(()=>a[8]||(a[8]=[c("新增收货地址")])),_:1})]),e(j,{data:o.value,style:{width:"100%"}},{default:n(()=>[e(L,{label:"收货信息","min-width":"400"},{default:n(({row:t})=>[s("div",xe,[s("span",Ve,v(t.name),1),s("span",$e,v(t.phone),1),s("span",Ce,v(P(t)),1)])]),_:1}),e(L,{prop:"address",label:"详细地址"}),e(L,{label:"操作",width:"200"},{default:n(({row:t})=>[e(I,{type:"primary",link:"",onClick:l=>u(t)},{default:n(()=>a[9]||(a[9]=[c("编辑")])),_:2},1032,["onClick"]),e(I,{type:"danger",link:"",onClick:l=>w(t)},{default:n(()=>a[10]||(a[10]=[c("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(G,{modelValue:$.value,"onUpdate:modelValue":a[7]||(a[7]=t=>$.value=t),title:"添加收货地址",width:"500px","close-on-click-modal":!1},{footer:n(()=>[e(I,{onClick:a[6]||(a[6]=t=>$.value=!1)},{default:n(()=>a[12]||(a[12]=[c("取消")])),_:1}),e(I,{type:"primary",onClick:S},{default:n(()=>a[13]||(a[13]=[c("确认")])),_:1})]),default:n(()=>[e(Y,{model:i.value,rules:C,ref_key:"formRef",ref:_,"label-width":"100px"},{default:n(()=>[e(D,{label:"地址信息",prop:"region"},{default:n(()=>[e(F,{modelValue:i.value.region,"onUpdate:modelValue":a[0]||(a[0]=t=>i.value.region=t),options:M(f),placeholder:"请选择省/市/区",clearable:"",filterable:""},null,8,["modelValue","options"])]),_:1}),e(D,{label:"详细地址",prop:"address"},{default:n(()=>[e(A,{modelValue:i.value.address,"onUpdate:modelValue":a[1]||(a[1]=t=>i.value.address=t),type:"textarea",rows:2,placeholder:"请输入详细地址信息，如道路、门牌号、小区、楼栋号、单元等信息"},null,8,["modelValue"])]),_:1}),e(D,{label:"收货人",prop:"name"},{default:n(()=>[e(A,{modelValue:i.value.name,"onUpdate:modelValue":a[2]||(a[2]=t=>i.value.name=t),maxlength:"25","show-word-limit":"",placeholder:"长度不超过25个字符"},null,8,["modelValue"])]),_:1}),e(D,{label:"手机号",prop:"phone"},{default:n(()=>[e(W,{modelValue:i.value.phonePrefix,"onUpdate:modelValue":a[3]||(a[3]=t=>i.value.phonePrefix=t),style:{width:"110px","margin-right":"8px"}},{default:n(()=>[e(O,{label:"中国大陆 +86",value:"+86"}),e(O,{label:"中国香港 +852",value:"+852"}),e(O,{label:"中国澳门 +853",value:"+853"}),e(O,{label:"中国台湾 +886",value:"+886"})]),_:1},8,["modelValue"]),e(A,{modelValue:i.value.phone,"onUpdate:modelValue":a[4]||(a[4]=t=>i.value.phone=t),style:{width:"220px"},maxlength:"11",placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),e(D,null,{default:n(()=>[e(X,{modelValue:i.value.isDefault,"onUpdate:modelValue":a[5]||(a[5]=t=>i.value.isDefault=t)},{default:n(()=>a[11]||(a[11]=[c("设置为默认收货地址")])),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ue=E(Ie,[["__scopeId","data-v-5e8dd44d"]]),Se={class:"user-orders"},we={key:1},Te=["src"],ze={key:0},De={key:0},Le={key:1},Ae={key:0},Pe={key:0},qe={key:1},Me={key:1},Re={class:"order-action-btns"},je={class:"pagination"},Fe={key:0},Oe={key:0},Be={__name:"UserOrders",setup(H){const m=ae(),o=h("all"),$=h(1),y=h(10),i=h(0),_=ve(),C=Q(),f=le(()=>o.value==="all"?_.orders:o.value==="unpaid"?_.orders.filter(t=>t.status==="unpaid"||t.status==="cancelled"):_.orders.filter(t=>t.status===o.value)),p=h(!1),u=h(null),w=h({});let S=null;const k=()=>{const t=Date.now();_.orders.forEach(l=>{if(l.status==="unpaid"){const x=Math.floor((l.expireTime-t)/1e3);w.value[l.id]=x>0?x:0,x<=0&&_.cancelOrder(l.id)}})};se(()=>{k(),S=setInterval(k,1e3),_.orders.forEach((t,l)=>{t.status==="paid"&&(t.status=l%2===0?"unshipped":"shipped")})}),pe(()=>{S&&clearInterval(S)});const P=t=>t?new Date(t).toLocaleString():"",g=t=>({unpaid:"warning",unshipped:"info",shipped:"primary",completed:"success"})[t]||"info",a=t=>({unpaid:"待付款",unshipped:"待发货",shipped:"待收货",completed:"已完成"})[t]||t,I=()=>{},L=t=>{y.value=t},j=t=>{$.value=t},F=t=>{u.value=t,p.value=!0},D=t=>{m.push(`/order/payment/${t.id}`)},A=t=>{ee.confirm("确定要删除该订单吗？删除后无法恢复！","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{_.removeOrder(t.id),R.success("订单已删除")}).catch(()=>{})},O=t=>{var z,U;const l=(U=(z=C.userInfo)==null?void 0:z.addressList)==null?void 0:U.find(N=>N.id==t.addressId),T=`${l.region.map(N=>Z[N]).join(" ")} ${l.address}`;m.push({path:"/order/logistics-tracking",query:{orderId:t.id,to:T}})},W=t=>{var x,T;const l=(T=(x=C.userInfo)==null?void 0:x.addressList)==null?void 0:T.find(z=>z.id==t.addressId);return l?l.name:""},X=t=>{var x,T;const l=(T=(x=C.userInfo)==null?void 0:x.addressList)==null?void 0:T.find(z=>z.id==t.addressId);return l?l.phone:""},Y=t=>{var T,z;const l=(z=(T=C.userInfo)==null?void 0:T.addressList)==null?void 0:z.find(U=>U.id==t.addressId);return l?`${l.region.map(U=>Z[U]).join(" ")} ${l.address}`:""},G=le(()=>_.orders.filter(t=>t.status==="unpaid").length);return(t,l)=>{const x=r("el-tab-pane"),T=r("el-badge"),z=r("el-tabs"),U=r("el-table-column"),N=r("el-tag"),J=r("el-button"),oe=r("el-table"),ue=r("el-pagination"),re=r("el-divider"),de=r("el-dialog");return b(),V("div",Se,[e(z,{modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=d=>o.value=d),onTabClick:I},{default:n(()=>[e(x,{label:"全部",name:"all"}),e(x,{name:"unpaid"},{label:n(()=>[G.value>0?(b(),K(T,{key:0,value:G.value,max:99,style:{"margin-right":"4px"}},{default:n(()=>l[4]||(l[4]=[s("span",null,"未支付",-1)])),_:1},8,["value"])):(b(),V("span",we,"未支付"))]),_:1}),e(x,{label:"待发货",name:"unshipped"}),e(x,{label:"待收货",name:"shipped"}),e(x,{label:"已完成",name:"completed"})]),_:1},8,["modelValue"]),e(oe,{data:f.value,style:{width:"100%"}},{default:n(()=>[e(U,{label:"商品图片",width:"100"},{default:n(({row:d})=>[d.image?(b(),V("img",{key:0,src:d.image,alt:"商品图片",style:{width:"60px",height:"60px","object-fit":"cover"}},null,8,Te)):B("",!0)]),_:1}),e(U,{prop:"name",label:"商品名称",width:"180"}),e(U,{prop:"specs",label:"规格",width:"180"},{default:n(({row:d})=>[d.specs?(b(),V("span",ze,v(Object.entries(d.specs).map(([q,ie])=>`${q}:${ie}`).join("，")),1)):B("",!0)]),_:1}),e(U,{prop:"amount",label:"订单金额",width:"120"},{default:n(({row:d})=>[d&&d.amount!==void 0?(b(),V("span",De,"¥"+v(Number(d.amount).toFixed(2)),1)):(b(),V("span",Le,"¥0.00"))]),_:1}),e(U,{prop:"quantity",label:"数量",width:"80"}),e(U,{prop:"status",label:"订单状态",width:"120"},{default:n(({row:d})=>[e(N,{type:g(d.status)},{default:n(()=>[c(v(a(d.status)),1)]),_:2},1032,["type"])]),_:1}),e(U,{label:"剩余支付时间",width:"140"},{default:n(({row:d})=>[d.status==="unpaid"?(b(),V("span",Ae,[w.value[d.id]>0?(b(),V("span",Pe,v(Math.floor(w.value[d.id]/60))+"分"+v(w.value[d.id]%60)+"秒 ",1)):(b(),V("span",qe,"已超时"))])):(b(),V("span",Me,"--"))]),_:1}),e(U,{label:"操作",width:"320"},{default:n(({row:d})=>[s("div",Re,[e(J,{type:"primary",onClick:q=>F(d)},{default:n(()=>l[5]||(l[5]=[c("查看详情")])),_:2},1032,["onClick"]),d.status==="unpaid"?(b(),K(J,{key:0,type:"success",onClick:q=>D(d)},{default:n(()=>l[6]||(l[6]=[c(" 去支付 ")])),_:2},1032,["onClick"])):B("",!0),e(J,{type:"danger",onClick:q=>A(d)},{default:n(()=>l[7]||(l[7]=[c(" 删除 ")])),_:2},1032,["onClick"]),d.status==="shipped"?(b(),K(J,{key:1,type:"info",onClick:q=>O(d)},{default:n(()=>l[8]||(l[8]=[c(" 查看物流 ")])),_:2},1032,["onClick"])):B("",!0)])]),_:1})]),_:1},8,["data"]),s("div",je,[e(ue,{"current-page":$.value,"onUpdate:currentPage":l[1]||(l[1]=d=>$.value=d),"page-size":y.value,"onUpdate:pageSize":l[2]||(l[2]=d=>y.value=d),total:i.value,"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next",onSizeChange:L,onCurrentChange:j},null,8,["current-page","page-size","total"])]),e(de,{modelValue:p.value,"onUpdate:modelValue":l[3]||(l[3]=d=>p.value=d),title:"订单详情",width:"500px"},{default:n(()=>[u.value?(b(),V("div",Fe,[s("p",null,[l[9]||(l[9]=s("b",null,"订单编号：",-1)),c(v(u.value.orderNo),1)]),s("p",null,[l[10]||(l[10]=s("b",null,"下单时间：",-1)),c(v(P(u.value.createTime)),1)]),s("p",null,[l[11]||(l[11]=s("b",null,"收货人：",-1)),c(v(W(u.value)),1)]),s("p",null,[l[12]||(l[12]=s("b",null,"联系电话：",-1)),c(v(X(u.value)),1)]),s("p",null,[l[13]||(l[13]=s("b",null,"收货地址：",-1)),c(v(Y(u.value)),1)]),e(re),s("p",null,[l[14]||(l[14]=s("b",null,"商品名称：",-1)),c(v(u.value.name),1)]),s("p",null,[l[15]||(l[15]=s("b",null,"规格：",-1)),u.value.specs?(b(),V("span",Oe,v(Object.entries(u.value.specs).map(([d,q])=>`${d}:${q}`).join("，")),1)):B("",!0)]),s("p",null,[l[16]||(l[16]=s("b",null,"数量：",-1)),c(v(u.value.quantity),1)]),s("p",null,[l[17]||(l[17]=s("b",null,"订单金额：",-1)),c("¥"+v(Number(u.value.amount).toFixed(2)),1)])])):B("",!0)]),_:1},8,["modelValue"])])}}},Ne=E(Be,[["__scopeId","data-v-207c8b60"]]),Ee={class:"user-favorites"},He=["src"],Ge={class:"product-info"},Je={class:"price"},Ke={class:"actions"},Qe={class:"pagination"},We={__name:"UserFavorites",setup(H){const m=h(1),o=h(12),$=h(0),y=h([]),i=p=>{R.success("已加入购物车")},_=p=>{ee.confirm("确定要取消收藏该商品吗？","提示",{type:"warning"}).then(()=>{R.success("已取消收藏")})},C=p=>{o.value=p},f=p=>{m.value=p};return(p,u)=>{const w=r("el-button"),S=r("el-card"),k=r("el-col"),P=r("el-row"),g=r("el-pagination");return b(),V("div",Ee,[e(P,{gutter:20},{default:n(()=>[(b(!0),V(me,null,ce(y.value,a=>(b(),K(k,{key:a.id,xs:24,sm:12,md:8,lg:6},{default:n(()=>[e(S,{class:"favorite-item","body-style":{padding:"0px"}},{default:n(()=>[s("img",{src:a.image,class:"product-image"},null,8,He),s("div",Ge,[s("h3",null,v(a.name),1),s("p",Je,"¥"+v(a.price.toFixed(2)),1),s("div",Ke,[e(w,{type:"primary",onClick:I=>i(a)},{default:n(()=>u[2]||(u[2]=[c("加入购物车")])),_:2},1032,["onClick"]),e(w,{type:"danger",onClick:I=>_(a)},{default:n(()=>u[3]||(u[3]=[c("取消收藏")])),_:2},1032,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),s("div",Qe,[e(g,{"current-page":m.value,"onUpdate:currentPage":u[0]||(u[0]=a=>m.value=a),"page-size":o.value,"onUpdate:pageSize":u[1]||(u[1]=a=>o.value=a),total:$.value,"page-sizes":[12,24,36,48],layout:"total, sizes, prev, pager, next",onSizeChange:C,onCurrentChange:f},null,8,["current-page","page-size","total"])])])}}},Xe=E(We,[["__scopeId","data-v-85fa634b"]]),Ye={class:"user-center"},Ze={class:"card-header"},et={class:"header-actions"},tt={class:"user-brief"},lt={class:"user-info"},nt={__name:"index",setup(H){const m=Q(),o=ae(),$=_e(),y=h("profile"),i=()=>{o.push("/home")},_=()=>{m.logout(),o.push("/login")},C=f=>f?new Date(f).toLocaleString():"";return se(()=>{$.query.tab==="orders"&&(y.value="orders")}),(f,p)=>{const u=r("el-button"),w=r("el-avatar"),S=r("el-tab-pane"),k=r("el-tabs"),P=r("el-card");return b(),V("div",Ye,[p[3]||(p[3]=s("div",{class:"background-image"},null,-1)),e(P,{class:"user-center-card"},{header:n(()=>{var g,a,I,L;return[s("div",Ze,[s("div",et,[e(u,{type:"primary",onClick:i},{default:n(()=>p[1]||(p[1]=[c("返回首页")])),_:1}),e(u,{type:"danger",onClick:_},{default:n(()=>p[2]||(p[2]=[c("退出登录")])),_:1})]),s("div",tt,[e(w,{size:64,src:(g=M(m).userInfo)==null?void 0:g.avatar},{default:n(()=>{var j,F,D,A;return[c(v(((F=(j=M(m).userInfo)==null?void 0:j.nickname)==null?void 0:F.charAt(0))||((A=(D=M(m).userInfo)==null?void 0:D.username)==null?void 0:A.charAt(0))),1)]}),_:1},8,["src"]),s("div",lt,[s("h3",null,v(((a=M(m).userInfo)==null?void 0:a.nickname)||((I=M(m).userInfo)==null?void 0:I.username)),1),s("p",null,"注册时间："+v(C((L=M(m).userInfo)==null?void 0:L.createTime)),1)])])])]}),default:n(()=>[e(k,{modelValue:y.value,"onUpdate:modelValue":p[0]||(p[0]=g=>y.value=g),class:"user-tabs"},{default:n(()=>[e(S,{label:"个人信息",name:"profile"},{default:n(()=>[e(he)]),_:1}),e(S,{label:"收货地址",name:"address"},{default:n(()=>[e(Ue)]),_:1}),e(S,{label:"我的订单",name:"orders"},{default:n(()=>[e(Ne)]),_:1}),e(S,{label:"我的收藏",name:"favorites"},{default:n(()=>[e(Xe)]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}},rt=E(nt,[["__scopeId","data-v-6b7aff83"]]);export{rt as default};
