import{_ as K,k as Q,r as y,B as W,E as O,u as X,p as k,c as m,b as s,C as Y,d as o,w as n,e as i,f as v,t as d,o as c,h as C,D as Z,G as ee,g as te,F as j,i as E,j as w,m as I}from"./index-CXWT5NW2.js";import{useUserStore as se}from"./user-DnAwSLmC.js";import{u as oe}from"./order-CyT1VBxf.js";import{d as ae}from"./element-china-area-data-DyMRb5Dq.js";const ne={class:"order-confirm"},le={class:"detail-nav"},re={class:"nav-content"},ue={class:"nav-right"},ie={class:"confirm-container"},de={class:"address-section"},ce={class:"address-item"},pe={class:"receiver"},me={class:"address-detail"},_e={class:"product-list"},ve=["src"],fe={key:0},ye={key:0},ge={key:0},be={class:"coupon-section"},he={class:"order-amount"},qe={class:"amount-item"},ke={class:"amount-item"},Ce={class:"amount-item total"},Ie={class:"price"},Se={class:"submit-order"},xe={__name:"OrderConfirm",setup(Ae){var B;const p=W(),V=X(),D=se(),J=oe(),N=Q(),L=y(((B=D.userInfo)==null?void 0:B.addressList)||[]),g=y("");let l=y(null);if(p.query.productId)l.value={id:p.query.productId,name:p.query.name,price:Number(p.query.price),quantity:Number(p.query.quantity),specs:JSON.parse(p.query.specs),image:p.query.image};else{const a=localStorage.getItem("checkoutItems");a?l.value=JSON.parse(a):(O.error("没有可结算的商品"),V.push("/cart"))}const F=y([{id:1,name:"满1000减100",amount:100,condition:1e3},{id:2,name:"满2000减200",amount:200,condition:2e3}]),f=y(""),S=k(()=>Array.isArray(l.value)?l.value.reduce((a,e)=>a+e.price*e.quantity,0):l.value?l.value.price*l.value.quantity:0),b=k(()=>{if(!f.value)return 0;const a=F.value.find(e=>e.id===f.value);return a&&S.value>=a.condition?a.amount:0}),R=k(()=>S.value-b.value),U=async()=>{if(!g.value){O.warning("请选择收货地址");return}try{const a=Array.isArray(l.value)?l.value:[l.value],e=[];for(let u=0;u<a.length;u++){const r=a[u];let h=r.price*r.quantity;u===0&&b.value>0&&(h-=b.value);const x={productId:r.id,name:r.name,image:r.image,specs:r.specs,price:r.price,quantity:r.quantity,addressId:g.value,couponId:f.value,amount:h},A=await J.createOrder(x);e.push(A)}a.forEach(u=>{N.removeFromCart(u.id,u.specs)}),localStorage.setItem("payOrderIds",JSON.stringify(e)),V.push(`/order/payment/${e[0]}`)}catch{O.error("创建订单失败")}},$=k(()=>N.cartCount),z=a=>!a||!Array.isArray(a)?"":a.map(e=>ae[e]||e).join(" ");return(a,e)=>{const u=i("el-icon"),r=i("router-link"),h=i("el-badge"),x=i("el-radio"),A=i("el-radio-group"),_=i("el-table-column"),G=i("el-table"),M=i("el-option"),P=i("el-select"),T=i("el-button");return c(),m("div",ne,[s("div",le,[s("div",re,[e[5]||(e[5]=s("div",{class:"nav-left"},[s("div",{class:"logo"},[s("img",{src:Y,alt:"淘淘商城"})])],-1)),s("div",ue,[o(r,{to:"/",class:"nav-item"},{default:n(()=>[o(u,null,{default:n(()=>[o(v(Z))]),_:1}),e[2]||(e[2]=C(" 首页 "))]),_:1}),o(r,{to:"/cart",class:"nav-item"},{default:n(()=>[o(h,{value:$.value,class:"cart-badge"},{default:n(()=>[o(u,null,{default:n(()=>[o(v(ee))]),_:1}),e[3]||(e[3]=C(" 购物车 "))]),_:1},8,["value"])]),_:1}),o(r,{to:"/user",class:"nav-item"},{default:n(()=>[o(u,null,{default:n(()=>[o(v(te))]),_:1}),e[4]||(e[4]=C(" 个人中心 "))]),_:1})])])]),s("div",ie,[s("div",de,[e[6]||(e[6]=s("h2",null,"收货地址",-1)),o(A,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t)},{default:n(()=>[(c(!0),m(j,null,E(L.value,t=>(c(),w(x,{key:t.id,value:t.id},{default:n(()=>[s("div",ce,[s("div",pe,[s("span",null,d(t.name),1),s("span",null,d(t.phone),1)]),s("div",me,d(z(t.region))+" "+d(t.address),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),s("div",_e,[e[7]||(e[7]=s("h2",null,"商品清单",-1)),o(G,{data:Array.isArray(v(l))?v(l):[v(l)],style:{width:"100%"}},{default:n(()=>[o(_,{prop:"image",label:"商品图片",width:"180"},{default:n(({row:t})=>[t&&t.image?(c(),m("img",{key:0,src:t.image,class:"product-image"},null,8,ve)):I("",!0)]),_:1}),o(_,{prop:"name",label:"商品名称"}),o(_,{prop:"specs",label:"规格",width:"180"},{default:n(({row:t})=>[t&&t.specs?(c(),m("span",fe,d(Object.entries(t.specs).map(([q,H])=>`${q}:${H}`).join("，")),1)):I("",!0)]),_:1}),o(_,{prop:"price",label:"单价",width:"120"},{default:n(({row:t})=>{var q;return[t?(c(),m("span",ye,"¥"+d((q=t.price)==null?void 0:q.toFixed(2)),1)):I("",!0)]}),_:1}),o(_,{prop:"quantity",label:"数量",width:"120"}),o(_,{label:"小计",width:"120"},{default:n(({row:t})=>[t?(c(),m("span",ge,"¥"+d((t.price*t.quantity).toFixed(2)),1)):I("",!0)]),_:1})]),_:1},8,["data"])]),s("div",be,[e[8]||(e[8]=s("h2",null,"优惠券",-1)),o(P,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=t=>f.value=t),placeholder:"请选择优惠券"},{default:n(()=>[(c(!0),m(j,null,E(F.value,t=>(c(),w(M,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),s("div",he,[s("div",qe,[e[9]||(e[9]=s("span",null,"商品总额：",-1)),s("span",null,"¥"+d(S.value.toFixed(2)),1)]),s("div",ke,[e[10]||(e[10]=s("span",null,"优惠金额：",-1)),s("span",null,"-¥"+d(b.value.toFixed(2)),1)]),s("div",Ce,[e[11]||(e[11]=s("span",null,"应付金额：",-1)),s("span",Ie,"¥"+d(R.value.toFixed(2)),1)])]),s("div",Se,[o(T,{type:"primary",size:"large",onClick:U},{default:n(()=>e[12]||(e[12]=[C("提交订单")])),_:1})])])])}}},Be=K(xe,[["__scopeId","data-v-4b572ccb"]]);export{Be as default};
