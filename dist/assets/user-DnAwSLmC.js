import{H as u}from"./index-CXWT5NW2.js";const l=u("user",{state:()=>({token:localStorage.getItem("token")||"",userInfo:JSON.parse(localStorage.getItem("userInfo"))||{username:"",nickname:"",phone:"",email:"",createTime:"",avatar:"",addressList:[]},addressForm:{region:[],address:"",name:"",phonePrefix:"+86",phone:"",isDefault:!1,id:null}}),actions:{setToken(e){this.token=e,localStorage.setItem("token",e)},setUserInfo(e){this.userInfo=e,localStorage.setItem("userInfo",JSON.stringify(e))},async login(e,r){return new Promise((a,s)=>{setTimeout(()=>{const t=(JSON.parse(localStorage.getItem("users"))||[]).find(i=>i.username===e);if(!t){s(new Error("用户不存在"));return}if(t.password!==r){s(new Error("密码错误"));return}const n="token_"+Math.random().toString(36).substr(2);this.setToken(n),this.setUserInfo(t),a({token:n,user:t})},1e3)})},async register(e,r){return new Promise((a,s)=>{setTimeout(()=>{const o=JSON.parse(localStorage.getItem("users"))||[];if(o.some(n=>n.username===e)){s(new Error("用户名已存在"));return}const t={id:Date.now(),username:e,password:r,createTime:new Date().toISOString()};o.push(t),localStorage.setItem("users",JSON.stringify(o)),this.login(e,r).then(a).catch(s)},1e3)})},logout(){this.token="",this.userInfo={username:"",nickname:"",phone:"",email:"",createTime:"",avatar:"",addressList:[]},localStorage.removeItem("token"),localStorage.removeItem("userInfo")},updateUserInfo(e){this.userInfo={...this.userInfo,...e},localStorage.setItem("userInfo",JSON.stringify(this.userInfo))}}});export{l as useUserStore};
