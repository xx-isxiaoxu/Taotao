import{_ as D,r as p,v as M,B as S,E as a,u as E,A as P,c as f,L as R,R as T,b as r,m as U,h as n,t as m,d as l,w as d,e as g,o as h}from"./index-CXWT5NW2.js";import{u as L}from"./order-CyT1VBxf.js";const q="/assets/alipay-C-nMLaso.png",z="/assets/wechat-Bwnbk70X.png",A={class:"payment-page"},F={class:"payment-container"},J={class:"order-info"},X={class:"amount"},$={class:"price"},j={class:"order-no"},G={class:"payment-extra-actions",style:{"text-align":"center","margin-bottom":"20px"}},H={class:"payment-methods"},K={class:"payment-action"},Q={key:0,class:"countdown"},W={__name:"OrderPayment",setup(Y){const O=S(),s=E(),i=L(),t=p({amount:0,orderNo:"",id:null}),v=p("alipay"),_=p(!1),u=p(0);let c=null;const x=()=>{c=setInterval(()=>{const o=Date.now(),e=Math.floor((t.value.expireTime-o)/1e3);u.value=e>0?e:0,u.value<=0&&(clearInterval(c),i.cancelOrder(t.value.id),a.error("订单超时已取消"),I())},1e3)};M(async()=>{const o=O.params.orderId;if(!o){a.error("订单ID不存在"),s.push("/");return}_.value=!0;try{const e=await i.getOrderDetail(o);e?t.value=e:(a.error("订单不存在"),s.push("/"))}catch(e){console.error("获取订单信息失败:",e),a.error("获取订单信息失败"),s.push("/")}finally{_.value=!1}x()}),P(()=>{c&&clearInterval(c)});const k=async()=>{let o=[];try{o=JSON.parse(localStorage.getItem("payOrderIds"))||[]}catch{o=[t.value.id]}o.length||(o=[t.value.id]);try{o.forEach(e=>{i.payOrder({orderId:e,method:v.value})}),localStorage.removeItem("payOrderIds"),s.push(`/order/result/${t.value.id}`)}catch(e){console.error("支付失败:",e),a.error("支付失败")}},b=()=>{s.back()},C=async()=>{if(!t.value.id){a.error("订单信息不完整");return}await i.cancelOrder(t.value.id),a.success("订单已取消"),I()},I=()=>{s.push({path:"/user",query:{tab:"orders"}})};return(o,e)=>{const y=g("el-button"),w=g("el-radio"),N=g("el-radio-group"),V=T("loading");return h(),f("div",A,[R((h(),f("div",F,[e[8]||(e[8]=r("h1",null,"订单支付",-1)),r("div",J,[r("div",X,[e[1]||(e[1]=n(" 支付金额：")),r("span",$,"¥"+m((t.value.amount||0).toFixed(2)),1)]),r("div",j," 订单编号："+m(t.value.orderNo||"--"),1)]),r("div",G,[l(y,{onClick:b},{default:d(()=>e[2]||(e[2]=[n("返回")])),_:1}),l(y,{type:"danger",onClick:C},{default:d(()=>e[3]||(e[3]=[n("取消订单")])),_:1})]),r("div",H,[e[6]||(e[6]=r("h2",null,"选择支付方式",-1)),l(N,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=B=>v.value=B)},{default:d(()=>[l(w,{value:"alipay"},{default:d(()=>e[4]||(e[4]=[r("img",{src:q,alt:"支付宝",class:"payment-icon"},null,-1),n(" 支付宝 ")])),_:1}),l(w,{value:"wechat"},{default:d(()=>e[5]||(e[5]=[r("img",{src:z,alt:"微信支付",class:"payment-icon"},null,-1),n(" 微信支付 ")])),_:1})]),_:1},8,["modelValue"])]),r("div",K,[l(y,{type:"primary",size:"large",onClick:k},{default:d(()=>e[7]||(e[7]=[n(" 立即支付 ")])),_:1})]),t.value.status==="unpaid"?(h(),f("div",Q," 剩余支付时间："+m(Math.floor(u.value/60))+"分"+m(u.value%60)+"秒 ",1)):U("",!0)])),[[V,_.value]])])}}},te=D(W,[["__scopeId","data-v-00a97b25"]]);export{te as default};
